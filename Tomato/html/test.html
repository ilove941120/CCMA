<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
      }
      .clockBlock {
        width: 200px;
        height: 200px;
        border-radius: 550%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: antiquewhite;
        border: 2px solid black;
        font-size: 50px;
        margin: auto;
        margin-bottom: 20px;
      }
      .tasklist {
        display: flex;
        flex-direction: column;
        width: 300px;
      }
      .taskListContent {
        width: 300px;
      }
      .basic {
        border: 1px solid black;
        padding: 10px;
      }
      .taskName {
        min-width: 200px;
      }
      .taskTime {
        min-width: 150px;
        text-align: center;
      }
      .restTime {
        min-width: 150px;
        text-align: center;
      }
      .activeNum {
        min-width: 150px;
        text-align: center;
      }
      .taskStatus {
        min-width: 100px;
        text-align: center;
      }
      .tasking {
        min-width: 100px;
        display: flex;
        align-self: center;
        justify-content: center;
      }
      .testBox {
        min-width: 100px;
      }
      .row {
        display: flex;
      }
      .activIngNum{
        position: absolute;
        top: 3%;
        width: 50px;
        height: 50px;
        background-color: rgb(243, 159, 159);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <div class="div">
      <img src="./data/download.jpg" alt="">
    </div>
    <!-- 時鐘 -->
    <div class="clockBlock">
      <div class="clockTime"></div>
      <div class="activIngNum">5</div>
    </div>
    任務名稱: <input type="text" class="taskNameSet" /> <br />
    <div class="setTaskBlock">
      <label for="activeTime">活動時間</label>
      <div id="activeTime">
        時<input type="text" class="activeTimeHour" value="0" /> 
        分<input type="text" class="activeTimeMinute" value="0" />
        秒<input type="text" class="activeTimeSecond" value="0" />
      </div>
      <label for="restTime">休息時間</label>
      <div id="restTime">
        時<input type="text" class="restTimeHour" value="0" /> 
        分<input type="text" class="restTimeMinute" value="0" />
        秒<input type="text" class="restTimeSecond" value="0" />
      </div>
      <label for="restTime">循環次數</label>
      <input type="text" id="activeNum" value="0">
    </div>
    <div></div>
    <button class="sent">時間設定</button>
    <button class="choose1">選擇任務</button>
    <button class="reciprocal">開始倒數</button>
    <hr />
    <div class="taskListBlock">
      <div class="tasklist">
        <div class="row">
          <div class="basic taskName">任務名稱</div>
          <div class="basic taskTime">任務時間</div>
          <div class="basic restTime">休息時間</div>
          <div class="basic activeNum">循環次數</div>
          <div class="basic taskStatus">任務狀態</div>
          <div class="basic tasking">任務選擇</div>
        </div>
      </div>
      <div class="taskListContent"></div>
    </div>
    <!-- <script src="../../js/jquery-3.5.1.min.js"></script> -->
    <!-- <script src="../../js/axios_min.js"></script> -->
    <script src="./js/jQurey3.6.0.js"></script>

    <script
  src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      //活動時間設定
      var activeTimeHour = $(".activeTimeHour").val();
      var activeTimeMinute = $(".activeTimeMinute").val();
      var activeTimeSecond = $(".activeTimeSecond").val();
      var hour = activeTimeHour;
      var minute = activeTimeMinute;
      var second = activeTimeSecond;
      var time = hour + ":" + minute + ":" + second;
      //休息時間設定
      var hourRe
      var minuteRe
      var secondRe
      var timeRe

      //任務設定
      var taskName;
      var taskStatus = false;
      var seq = 3;
      var str
      var str1 = `
            <div class="row" id=1>
                <div class="basic taskName" >25分鐘</div>
                <div class="basic taskTime" data-hour=0 data-minute=25 data-second=0>0:25:0</div>
                <div class="basic restTime" data-hour=0 data-minute=5 data-second=0 data-stutus="false">0:5:0</div>
                <div class="basic activeNum" data-activenum=2>2</div>

                <div class="basic taskStatus" data-stutus="false">未完成</div>
                <div class="basic tasking">
                    <input type="radio" class="choose" name="tasking" value=1>
                </div>
            </div>
            <div class="row" id=2>
                <div class="basic taskName" >測試</div>
                <div class="basic taskTime" data-hour=0 data-minute=0 data-second=5>0:0:5</div>
                <div class="basic restTime" data-hour=0 data-minute=0 data-second=4 data-stutus="false">0:0:4</div>
                <div class="basic activeNum" data-activenum=2>2</div>

                <div class="basic taskStatus" data-stutus="false">未完成</div>
                <div class="basic tasking">
                    <input type="radio" class="choose" name="tasking" value=2>
                </div>
            </div>
        `;
      var taskingSeq;
      var clock;
      var activeNumSet
      var activeNum
      var doNum=0


      var me= { name:'Emma'}
      console.log(JSON.stringify(me))

      //執行區
      $(document).ready(function () {
        $(".clockTime").text(time);
        $(".reciprocal").click(reciprocal);
        $(".sent").click(sentClcok);
        //$(".tasklist").append(str1);

        $(document).on("click", "input[type=radio][name=tasking]", getClock);

        axios.get("data/data.json")

        .then(function(response){
          const thisData = response.data;
          console.log(thisData)

          let str2 =""
           $.each(thisData,function(n,item){
            var time = `${item.hour}:${item.minute}:${item.second}`
            var timeRe = `${item.hourRe}:${item.minuteRe}:${item.secondRe}`
            str2 += `
                    <div class="row" id=${item.seq}>
                        <div class="basic taskName" >${item.taskName}</div>
                        <div class="basic taskTime" data-hour=${item.hour} data-minute=${item.minute} data-second=${item.second}>${time}</div>
                        <div class="basic restTime" data-hour=${item.hourRe} data-minute=${item.minuteRe} data-second=${item.secondRe}>${timeRe}</div>
                        <div class="basic activeNum" data-activenum=${item.activeNumSet}>${item.activeNumSet}</div>
                        <div class="basic taskStatus" data-stutus="${item.taskStatus}">未完成</div>
                        <div class="basic tasking">
                            <input type="radio" class="choose" name="tasking" value=${item.seq}>
                        </div>
                    </div>
                  `;
           })
          //scenes3Content.innerHTML = str    
          $(".tasklist").append(str2);
        });
      });
      //倒數功能開啟 -活動時間
      function reciprocal() {
        getClock();
        clock = setInterval(function () {
          clockAdd10s();
        }, 1000);
      }
      //倒數功能開啟 -休息時間
      function reciprocalRe() {
        getRetestClock();
        clock = setInterval(function () {
          clockAdd10sRe();
        }, 1000);
      }
      //活動倒數功能
      function clockAdd10s() {
        console.log(activeNum)
        if (hour == 0 && minute == 0 && second == 0) {
          clearInterval(clock);
          time = hour + ":" + minute + ":" + second;
          $(".clockTime").text(time);
          taskingSeq = $('input:radio[name="tasking"]:checked').val();
          doNum++
          $(".activIngNum").text(doNum);
          console.log(`活動進行中了${doNum}次`)
          if(doNum != activeNum){
            alert(`完成目標了${doNum}!!!開始休息!!`)
            reciprocalRe()
          }
          else{
            alert("完成任務了!!!")
            $("#" + taskingSeq).children(".taskStatus").text("完成");
            $("#" + taskingSeq).children(".taskStatus").attr("data-stutus", true);
            doNum = 0;
          }
        }
        else{
          time = hour + ":" + minute + ":" + second;
          second--;
          $(".clockTime").text(time);
          if (second == 0) {
            if (minute != 0) {
              minute--;
              second = 59;
            }
          }
          if (minute == 0) {
            if (hour != 0) {
              hour--;
              minute = 59;
            }
          }
        }
      }
      //休息倒數功能
      function clockAdd10sRe() {
        if (hour == 0 && minute == 0 && second == 0) {
          clearInterval(clock);
          alert("休息結束!!!");
          reciprocal()
        }
        else{
          time = hour + ":" + minute + ":" + second;
          second--;
          $(".clockTime").text(time);
          if (second == 0) {
            if (minute != 0) {
              minute--;
              second = 59;
            }
          }
          if (minute == 0) {
            if (hour != 0) {
              hour--;
              minute = 59;
            }
          }
        }
      }
      //任務設定
      function sentClcok() {
        hour = $(".activeTimeHour").val();
        minute = $(".activeTimeMinute").val();
        second = $(".activeTimeSecond").val();
        hourRe = $(".restTimeHour").val();
        minuteRe = $(".restTimeMinute").val();
        secondRe = $(".restTimeSecond").val();
        activeNumSet = $("#activeNum").val();
        time = hour + ":" + minute + ":" + second;
        timeRe = hourRe + ":" + minuteRe + ":" + secondRe;
        $(".clockTime").text(time);

        taskStatus = false;
        taskName = $(".taskNameSet").val();

        str = `
            <div class="row" id=${seq}>
                <div class="basic taskName" >${taskName}</div>
                <div class="basic taskTime" data-hour=${hour} data-minute=${minute} data-second=${second}>${time}</div>
                <div class="basic restTime" data-hour=${hourRe} data-minute=${minuteRe} data-second=${secondRe}>${timeRe}</div>
                <div class="basic activeNum" data-activenum=${activeNumSet}>${activeNumSet}</div>
                <div class="basic taskStatus" data-stutus="${taskStatus}">未完成</div>
                <div class="basic tasking">
                    <input type="radio" class="choose" name="tasking" value=${seq}>
                </div>
            </div>
        `;
        $(".tasklist").append(str);
        seq++;
      }
      //取得任務時間
      function getClock(taskingSeq) {
        taskingSeq = $('input:radio[name="tasking"]:checked').val();
        hour = $("#" + taskingSeq).children(".taskTime").data("hour");
        minute = $("#" + taskingSeq).children(".taskTime").data("minute");
        second = $("#" + taskingSeq).children(".taskTime").data("second");
        activeNum = $("#" + taskingSeq).children(".activeNum").data("activenum");
        time = hour + ":" + minute + ":" + second;
        $(".clockTime").text(time);
        $(".activIngNum").text(activeNum);
      }
      //取得休息時間
      function getRetestClock(taskingSeq) {
        taskingSeq = $('input:radio[name="tasking"]:checked').val();
        hour = $("#" + taskingSeq).children(".restTime").data("hour");
        minute = $("#" + taskingSeq).children(".restTime").data("minute");
        second = $("#" + taskingSeq).children(".restTime").data("second");
        time = hour + ":" + minute + ":" + second;
        $(".clockTime").text(time);
        console.log("休息中")
      }

      
    </script>
  </body>
</html>
